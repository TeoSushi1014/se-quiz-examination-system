<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="quiz_examination_system.HistoryPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:quiz_examination_system"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="Transparent"
    Loaded="Page_Loaded">

    <Grid Padding="32,24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,24">
            <TextBlock Text="Quiz History" Style="{StaticResource TitleTextBlockStyle}"/>
            <TextBlock Text="View your past quiz attempts and results" 
                       Style="{StaticResource BodyTextBlockStyle}" 
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
        </StackPanel>

        <!-- Content -->
        <Grid Grid.Row="1">
            <!-- Loading -->
            <ProgressRing x:Name="LoadingRing" IsActive="False" Width="48" Height="48" 
                          HorizontalAlignment="Center" VerticalAlignment="Center"/>
            
            <!-- Empty State -->
            <StackPanel x:Name="EmptyState" Visibility="Collapsed" 
                        HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16">
                <FontIcon Glyph="&#xE81C;" FontSize="64" 
                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <TextBlock Text="No quiz attempts yet" 
                           Style="{StaticResource SubtitleTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <TextBlock Text="Complete a quiz to see your history here" 
                           Style="{StaticResource BodyTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
            </StackPanel>

            <!-- History List -->
            <ListView x:Name="HistoryListView" SelectionMode="None">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="local:AttemptItem">
                        <Grid Padding="16" Margin="0,4" CornerRadius="8"
                              Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                              BorderThickness="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Quiz Info -->
                            <StackPanel Grid.Column="0" Spacing="4">
                                <TextBlock Text="{x:Bind QuizTitle, Mode=OneWay}" 
                                           Style="{StaticResource BodyStrongTextBlockStyle}"
                                           TextTrimming="CharacterEllipsis"/>
                                <StackPanel Orientation="Horizontal" Spacing="16">
                                    <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                        <Run Text="Attempt #"/>
                                        <Run Text="{x:Bind AttemptNumber, Mode=OneWay}"/>
                                    </TextBlock>
                                    <TextBlock Text="{x:Bind SubmittedAt, Mode=OneWay}"
                                               Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                        <Run Text="Time: "/>
                                        <Run Text="{x:Bind TimeSpent, Mode=OneWay}"/>
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>

                            <!-- Score -->
                            <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" 
                                        VerticalAlignment="Center" Margin="16,0">
                                <TextBlock Style="{StaticResource BodyTextBlockStyle}">
                                    <Run Text="{x:Bind CorrectCount, Mode=OneWay}" FontWeight="SemiBold" 
                                         Foreground="{ThemeResource SystemFillColorSuccessBrush}"/>
                                    <Run Text=" correct, "/>
                                    <Run Text="{x:Bind IncorrectCount, Mode=OneWay}" FontWeight="SemiBold"
                                         Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>
                                    <Run Text=" incorrect"/>
                                </TextBlock>
                            </StackPanel>

                            <!-- Score Badge -->
                            <Border Grid.Column="2" 
                                    Background="{x:Bind ScoreBadgeColor, Mode=OneWay}"
                                    CornerRadius="8" Padding="16,8"
                                    VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <TextBlock Text="{x:Bind Score, Mode=OneWay}" 
                                               FontWeight="Bold" FontSize="18"
                                               Foreground="White"/>
                                    <TextBlock Text="/" Foreground="White" Opacity="0.7" FontSize="18"/>
                                    <TextBlock Text="{x:Bind TotalPoints, Mode=OneWay}" 
                                               Foreground="White" Opacity="0.7" FontSize="18"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Grid>

        <!-- InfoBar -->
        <InfoBar x:Name="ActionMessage" 
                 Grid.Row="1"
                 IsOpen="False" 
                 Severity="Informational" 
                 IsClosable="True"
                 VerticalAlignment="Bottom"
                 HorizontalAlignment="Right"
                 MaxWidth="400"
                 Margin="24">
        </InfoBar>
    </Grid>
</Page>
