<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="quiz_examination_system.QuizEditorPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:quiz_examination_system"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Background="Transparent"
    Loaded="Page_Loaded">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,24">
            <TextBlock Text="Create new quiz" FontSize="28" FontWeight="SemiBold"/>
            <TextBlock Text="Configure quiz settings and select questions" 
                       FontSize="14" 
                       Opacity="0.7"/>
        </StackPanel>

        <Pivot Grid.Row="1">
            <PivotItem Header="General settings">
                <ScrollViewer>
                    <StackPanel Spacing="16" MaxWidth="600" HorizontalAlignment="Left" Padding="0,16,0,0">
                        <TextBox x:Name="TitleTextBox"
                                Header="Quiz title"
                                PlaceholderText="Enter quiz title"
                                MaxLength="200"/>

                        <NumberBox x:Name="TimeLimitNumberBox"
                                  Header="Time limit (minutes)"
                                  Minimum="1"
                                  Maximum="300"
                                  Value="60"
                                  SpinButtonPlacementMode="Inline"/>

                        <NumberBox x:Name="TotalPointsNumberBox"
                                  Header="Total points"
                                  Minimum="1"
                                  Maximum="1000"
                                  Value="100"
                                  SpinButtonPlacementMode="Inline"/>

                        <ToggleSwitch x:Name="ShuffleQuestionsToggle"
                                     Header="Shuffle questions"
                                     OffContent="Questions in fixed order"
                                     OnContent="Questions randomized"/>

                        <ToggleSwitch x:Name="ShuffleAnswersToggle"
                                     Header="Shuffle answers"
                                     OffContent="Answers in fixed order"
                                     OnContent="Answers randomized"/>

                        <ComboBox x:Name="MaxAttemptsComboBox"
                                 Header="Maximum attempts"
                                 SelectedIndex="0"
                                 MinWidth="200">
                            <ComboBoxItem Content="Unlimited"/>
                            <ComboBoxItem Content="1"/>
                            <ComboBoxItem Content="2"/>
                            <ComboBoxItem Content="3"/>
                        </ComboBox>

                        <ComboBox x:Name="ResultVisibilityComboBox"
                                 Header="Result visibility"
                                 SelectedIndex="0"
                                 MinWidth="200">
                            <ComboBoxItem Content="Immediate"/>
                            <ComboBoxItem Content="After quiz end"/>
                            <ComboBoxItem Content="Manual release"/>
                        </ComboBox>
                    </StackPanel>
                </ScrollViewer>
            </PivotItem>

            <PivotItem Header="Select questions">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="16"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" 
                                  Text="Available questions" 
                                  FontWeight="SemiBold" 
                                  FontSize="16"
                                  Margin="0,0,0,12"/>

                        <AutoSuggestBox Grid.Row="1"
                                       x:Name="SearchBox"
                                       PlaceholderText="Search questions"
                                       QueryIcon="Find"
                                       TextChanged="OnSearchTextChanged"
                                       Margin="0,0,0,12"/>

                        <Border Grid.Row="2"
                               Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                               BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                               BorderThickness="1"
                               CornerRadius="8">
                            <Grid>
                                <ListView x:Name="AvailableQuestionsListView"
                                         SelectionMode="None">
                                    <ListView.ItemTemplate>
                                        <DataTemplate x:DataType="local:QuestionItem">
                                            <Grid Padding="12" ColumnSpacing="12">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>

                                                <CheckBox Grid.Column="0"
                                                         Tag="{x:Bind QuestionId}"
                                                         Checked="OnQuestionChecked"
                                                         Unchecked="OnQuestionUnchecked"/>

                                                <StackPanel Grid.Column="1" Spacing="4">
                                                    <TextBlock Text="{x:Bind QuestionText}"
                                                              TextWrapping="Wrap"
                                                              FontWeight="SemiBold"/>
                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                        <TextBlock Text="{x:Bind DifficultyLevel}"
                                                                  Foreground="{ThemeResource SystemAccentColor}"
                                                                  FontSize="12"/>
                                                        <TextBlock Text="{x:Bind Topic}"
                                                                  Opacity="0.7"
                                                                  FontSize="12"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>

                                <ProgressRing x:Name="LoadingRing"
                                             IsActive="False"
                                             Width="48"
                                             Height="48"/>
                            </Grid>
                        </Border>
                    </Grid>

                    <Grid Grid.Column="2">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="12" Margin="0,0,0,12">
                            <TextBlock Text="Selected questions" 
                                      FontWeight="SemiBold" 
                                      FontSize="16"
                                      VerticalAlignment="Center"/>
                            <Border Background="{ThemeResource SystemAccentColor}"
                                   CornerRadius="12"
                                   Padding="8,4">
                                <TextBlock x:Name="SelectedCountText"
                                          Text="0"
                                          Foreground="White"
                                          FontWeight="SemiBold"/>
                            </Border>
                        </StackPanel>

                        <Border Grid.Row="1"
                               Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                               BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                               BorderThickness="1"
                               CornerRadius="8">
                            <ListView x:Name="SelectedQuestionsListView"
                                     SelectionMode="None">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="local:QuestionItem">
                                        <Grid Padding="12" ColumnSpacing="12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <StackPanel Grid.Column="0" Spacing="4">
                                                <TextBlock Text="{x:Bind QuestionText}"
                                                          TextWrapping="Wrap"
                                                          FontWeight="SemiBold"/>
                                                <TextBlock Text="{x:Bind DifficultyLevel}"
                                                          Foreground="{ThemeResource SystemAccentColor}"
                                                          FontSize="12"/>
                                            </StackPanel>

                                            <Button Grid.Column="1"
                                                   Content="Remove"
                                                   Tag="{x:Bind QuestionId}"
                                                   Click="OnRemoveQuestionClicked"
                                                   Padding="8,4"/>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Border>
                    </Grid>
                </Grid>
            </PivotItem>
        </Pivot>

        <StackPanel Grid.Row="2" 
                   Orientation="Horizontal" 
                   Spacing="12" 
                   HorizontalAlignment="Right"
                   Margin="0,24,0,0">
            <Button Content="Cancel" 
                   Click="OnCancelClicked"
                   MinWidth="100"/>
            <Button x:Name="SaveButton"
                   Content="Save quiz" 
                   Click="OnSaveClicked"
                   Style="{StaticResource AccentButtonStyle}"
                   MinWidth="100"/>
        </StackPanel>

        <InfoBar x:Name="ActionMessage"
                Grid.Row="2"
                IsOpen="False"
                IsClosable="True"
                VerticalAlignment="Bottom"
                HorizontalAlignment="Center"
                MaxWidth="600"
                Margin="0,0,0,80"/>
    </Grid>
</Page>
